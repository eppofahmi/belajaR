---
title: Pre-processing data di R
subtitle: (Pelatihan data sains menggunakan R dan Gephi)
author: Ujang Fahmi
institute: "Pelajaran ke-2"
titlegraphic: styles/sadasa.png
fontsize: 10pt
output:
 beamer_presentation:
   template: styles/svm-latex-beamer.tex
   keep_tex: true
   latex_engine: xelatex # pdflatex also works here
   dev: cairo_pdf # I typically comment this out  if latex_engine: pdflatex
   slide_level: 3
make149: true
mainfont: "Open Sans" # Try out some font options if xelatex
titlefont: "Titillium Web" # Try out some font options if xelatex
---

```{r setup, include=FALSE, cache=F, message=F, warning=F, results="hide"}
knitr::opts_chunk$set(cache=TRUE, echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE)
knitr::opts_chunk$set(fig.path='figs/')
knitr::opts_chunk$set(cache.path='cache/')

knitr::opts_chunk$set(
                  fig.process = function(x) {
                      x2 = sub('-\\d+([.][a-z]+)$', '\\1', x)
                      if (file.rename(x, x2)) x2 else x
                      }
                  )
library(tidyverse)
library(stevemisc)
```

Salam kenal dan selamat datang.

Semoga kita semua bisa saling berbagi pengalaman dan pengetahuan. Saya adalah Ujang Fahmi, Co-founder dan mentor Sadasa Academy.

\vspace{0.1in}

Jika anda berada dan sedang membaca tutorial ini, maka kemungkinan anda adalah orang yang sedang ingin belajar data sains, atau mungkin ditugaskan untuk mempelajari R oleh institusi atau organisasi anda. Sama seperti saya dulu, dimana tanpa latar belakang enginering saya didiharuskan untuk belajar R, demi menyelesaikan tugas akhir dan akhirnya jadilah seperti saya sekarang ini.

\vspace{0.1in}

Satu hal yang pasti, ini adalah langkah pertama dari banyak langkah yang harus dilalui, entah melalui lembaga resmi atau belajar secara mandiri. Jadi selamat belajar!!!

\vspace{0.1in}

Ujang Fahmi,

`r paste("Yogyakarta,", Sys.Date())`

# Mendapatkan Bantuan dan Mengatasi Error

## Error yang umum 1

Di worksapce kita menulis

```{r, eval=FALSE}
a + 198
```

Di console menampilkan:

`Error: object 'a' not found`

Artinya objek `a` tidak bisa ditemukan sehingga R tidak bisa menyelesaikan perintah yang diberikan

## Error yang umum 2

Di workspace kita mencoba untuk memberikan perintah impor data dengan menggunakan fungsi `read_csv`, kita juga udah yakin argumen yang dibutuhkan sudah sesuai.

```{r}
df1 = read_csv("folder1/file.csv")
```

Tapi, di `console` kita masih tetap menerima error berikut:

`Error in read_csv("folder1/file.csv") :`

`could not find function "read_csv"`

Error menunjukkan bahwa fungsi `read_csv` tidak ditemukan. Artinya kita belum memanggil library yang dibutuhkan.

# Impor dan Ekspor Data

> Di R kita hanya bisa mengolah data yang yang sudah kita impor atau berada di *environment* R. Maka ketika ada `error: object not found` di console, sebagian besar disebabkan oleh data/objek yang belum ada.

## Impor Data

-   Impor data merupakan salah satu langkah pertama dan utama dalam pengolahan data
-   impor umumnya menggunakan sintak dengan awalan `read`. Misal `read.csv()` atau `read_csv`, sama-sama digunakan untuk impor data `.csv`

### Impor data frame

Data frame atau data flate di R bisa diimpor dengan beberapa sintaks dari beberapa package.

Argumen yang dibutuhkan:

1.  namfolder
2.  namafile atau link data

```{r}
# dasar
df1 = read.csv(file = "namafolder/namafile.csv", header = TRUE, 
               sep = ",")
# readr
library(readr)
df2 = read_csv(file = "namafolder/namafile.csv", trim_ws = TRUE)
# xlsx
library(readxl)
df3 = read_excel(path = "namafolder/namafile.xlsx", sheet = 1)
```

### Impor data json

`Json` atau `java script object notation` adalah format data yang umum digunakan untuk ditampilkan di sebuah laman/website.

Contoh:

> <https://raw.githubusercontent.com/eppofahmi/belajaR/master/upn-surabaya/data/sample.json>

```{r, eval=FALSE}
library(jsonlite)

df4 = fromJSON("namafolder/namafile.json",
               simplifyDataFrame = TRUE)
```

Sama seperi data lainnya, untuk mengimpor data `json` kita perlu menulis nama folder dan nama filenya. Selain data yang ada di folder dalam komputer, kita juga bisa membaca data yang ada di cloud atau website dengan ciri terdapta ekstensi data di url-nya seperti contoh di atas.

### Impor data lain

Selain jenis-jenis format data seperti yang sudah dibahas. Di R kita juga bisa membaca jenis lain, seperti:

1.  Data output dari SPSS dan Stata
2.  Data `.nc`
3.  Data list
4.  etc.

TIPS:

Jika ingin mengimpor data dengan ekstensi tertentu, kita bisa mencari tutorialnya dengan mengetikan di google search. Misalnya untuk membaca file stata, kita bisa menggunakan kata kunci berikut.

> read stata data in r

## Your Turn 1

1.  Buatlah data xlsx dan csv dengan menggunakan excel
2.  Letakan di folder data
3.  Impor data tersebut menggunakan sintak-sintak yang sudah dipelajari
4.  Impor data json dari url yang ada dicontoh

## Ekspor Data

Setelah bisa mengimpor, dan setelah melakukan pemrosesan di R, selanjutnya kita mungkin perlu menyimpan data dihardisk.

### Ekspor data frame

Jika untuk mengimpor sebagian besar fungsinya diawali dengan `read*` maka untuk mengekspor data sebagian besar fungsinya diawali dengan `write`.

Contoh:

```{r, eval=FALSE}
write_csv(namaobjek, "namafolder/namafile.csv")
```

### Ekspor list

List atau bisa juga disebut sebagai data bertingkat juga dapat disimpan atau diekspor dari R. Tipe data ini biasanya digunakan untuk menyimpan data hasil pengolahan dalam satu file. Untuk mengekspor list di R umumnya dilakukan menggunakan tipe data `.rds`. Tipe data ini hanya spesifik untuk R saja.

\vspace{0.1in}

Jika Menghendaki format yang lebih umum, maka sebaiknya list disimpan dalam format data yang juga umum. Misalnya json.

```{r}
library(readr)

write_rds(namaobjek, "namafolder/namafile.rds")
```

### Ekspor json

Untuk menyimpan json kita juga bisa menggunakan pola sintak yang sama seperti yang sudah dipelajari sebelumnya, yaitu:

```{r}
jsonlite::write_json(x = namaobjek, path = "namafolder/namafile.json")
```

# Pengecekan Data

> Cobalah untuk mengimpor data ke R, dan perhatikan apa yang ada dibagian environment.

```{r, eval=FALSE}
nama_objek1 = read_csv("folder/file.csv")
```

Gantilah nama folder dan file yang sesuai dengan yang dimiliki di laptop masing-masing

## Jumlah observasi dan variabel

::: {.columns}
::: {.column width="50%"}
-   Jumlah observasi menunjukkan jumlah baris, sementara jumlah variabel menunjukkan jumlah kolom
-   Selain itu, sebagai analis kita juga harus tahu masing-masing tipe variabel yang dimiliki
-   Untuk mengetahuinya kita bisa menggunakan fungsi glimpse()
:::

::: {.column width="50%"}
Contoh:

```{r, eval=TRUE}
nama_objek2 = mtcars
glimpse(nama_objek2)
```
:::
:::

## Rangkuman data

::: {.columns}
::: {.column width="50%"}
-   Untuk mendapatkan rangkuman dari data kita bisa menggunakan fungsi `summary()` atau `skim()` dari package `skimr`
-   Rangkuman biasanya digunakan untuk mendapatkan informasi umum terkait dengan data yang akan diolah
-   Rangkuman secara umum jika angka akan berupa *central tendency* statistik
-   Rangkuman data teks biasanya berupa jenis datanya saja
:::

::: {.column width="50%"}
Contoh:

```{r, eval=TRUE}
summary(nama_objek2)
```
:::
:::

# Penataan Data *(Data Wrangling)*

Penataan atau juga bisa disebut wrangling data juga merupakan salah satu bagian penting dalam tahap pra-pemrosesan data. Hal ini bisanya dilakukan mulai dari menstandarisasi nama kolom hingga memutuskan metode pengisian data yang kosong atau imputasi.

\vspace{0.1in}

Data wrangling berfungsi agar analis bisa fokus pada metode dan hasil pada saat melakukan analisis. Tidak lagi bingung atau harus menata data yang tidak terstruktur yang tidak mudah dipahami.

## Standar nama kolom

::: {.columns}
::: {.column width="50%"}
Nama kolom/variabel di R sebaiknya dibuat berdasarkan aturan yang sama untuk membuat objek R, yaitu:

-   Tidak diawali dengan angka (`kolom1`, bukan `1kolom`)
-   Tidak menggunakan spasi (`kolom_ke1` bukan `kolom ke 1`)
-   Sebaiknya menggunakan huruf yang seragam (huruf kecil atau besar semua)
:::

::: {.column width="50%"}
Contoh:

```{r}
library(janitor)
# impor data
df1 <- read_delim("data/sample.csv", ";", 
    escape_double = FALSE)
glimpse(df1)

# nama kolom standar
df1 = janitor::clean_names(df1)
glimpse(df1)
```
:::
:::

## Memilih Kolom dan Menyusun nama kolom

::: {.columns}
::: {.column width="50%"}
Untuk memilih nama kolom kita bisa menggunakan fungsi `select` dari `dplyr`. Namun sebelum menggunakannya, cobalah untuk menjalankan dan membaca dokumentasinya dengan menjalankan fungsi berikut:

```{r}
library(dplyr)

?dplyr::select
```
:::

::: {.column width="50%"}
Untuk menata atau mengurutkan kolom/variabel sesuai kebutuhan kita juga bisa mengkombinasikan fungsi `select()` dengan nomor indeks atau anam kolomnya.

Misalnya:

```{r}
nama_objek2 %>% 
   select(c(1:4, 10))
```

Kita memilih kolom 1 sampai 4 dan kolom ke 10 dari data `nama_objek2`
:::
:::

## Memilih Baris

-   Untuk memilih baris kita bisa menggunakan `filter()` dari dplyr
-   `filter()` digunakan untuk memilih baris dari data berdasarkan kondisi yang ditetapkan pada satu atau lebih kolom

```{r}
nama_objek2 %>% 
   filter(disp > 250)
```

Skrip diatas digunakan untuk memfilter (memilih baris) yang nilai dikolom `disp` nya lebih dari 250.

## Transformasi kolom

### Nama baris menjadi kolom

::: {.columns}
::: {.column width="50%"}
```{r, eval=TRUE}
df3 = mtcars
df3 %>% 
   select(1:2) %>% 
   head(5)
```
:::

::: {.column width="50%"}
```{r, eval=TRUE}
df3 = rownames_to_column(df3)
df3 %>% 
   select(1:2) %>% 
   head(5)
```
:::
:::

### Memisahkan nilai kolom

Untuk memisahkan nilai kolom kita bisa menggunakan fungsi `separate()`

```{r}
df4 = msleep
df4 %>% 
   select(1:3) %>% 
   head(5)
```

Menjadi...

```{r}
df4 = msleep
df4 = df4 %>% 
   separate(name, into = c("nama_depan", 
                           "nama_tengah", 
                           "nama_belakang"), 
            sep = " ") %>% 
   select(1:3) %>% 
   head(5)
```

### Menggabungkan nilai kolom

Untuk mengabungkan nilai beberapa kolom menjadi berada dalam satu kolom kita bisa menggunakan fungsi `unite()`

```{r}
df4 %>% 
   unite(col = "nama_lengkap", sep = " ", remove = FALSE)
```

### Membuat kolom baru dan Merangkum data

Untuk membuat kolom baru kita bisa menggunakan fungsi `mutate()`, di sini kita akan menggunakan dengan mengisi jumlah observasi dari kolom lain.

```{r}
fauna = msleep
rangkuman = fauna %>% 
   group_by(vore) %>% 
   count(order)
rangkuman

mobil = mtcars
mobil %>% 
   group_by(cyl) %>% 
   mutate(mean = mean(disp)) %>% 
   select(cyl, disp, mean)
```

# Mengatasasi Nilai Hilang

-   Terkadang kita memiliki data yang tidak semua barisnya terisi. Kondisi tersebut disebut value not available, missinf value atau `NA`.

-   Keputusan untuk tetap menggunakan data yang terdapat nilai kosong dalam salah satu variabelnya merupakan keputusan teoretis

-   Secara teknis, ada beberapa upaya yang bisa dilakukan. Upaya ini disebut imputasi.

Anggap saja kita memiliki data berikut, dimana tidak ada nilai yang kosong di dalamnya.

```{r, eval=TRUE}
library(missForest)
data(iris)
summary(iris)
```

## Menggunakan teknik manual

### Membuat nilai kosong untuk simulasi

```{r, eval=TRUE}
set.seed(1234)
iris.mis <- prodNA(iris, noNA = 0.2)
summary(iris.mis)
```

### Mengisi Nilai kosong dengan rerata

Dari rangkuman diketahui bahwa ada 25 bari yang kosong pada kolom `Sepal.Length`

```{r, eval=TRUE}
# mendapatakan rearata kolom Sepal.Length
# mean(iris.mis$Sepal.Length, na.rm = TRUE)
iris.mis = iris.mis %>% 
   mutate(Sepal.Length = case_when(
      is.na(Sepal.Length) ~ mean(iris.mis$Sepal.Length, na.rm = TRUE), 
      TRUE ~ Sepal.Length
   ))
summary(iris.mis)
```

## Menggunakan `package`

Untuk melakukan *imputation* kita bisa menggunakan fungsing `missForest()` seperti contoh skrip berikut.

```{r, eval=FALSE}
iris.imp <- missForest(iris.mis, xtrue = iris, verbose = TRUE)

iris.imp$OOBerror
iris.imp$error
result0 <- iris.imp$ximp

summary(result0)
```

## Paket lain untuk *imputation*

Selain dengan menggunakan paket `missForest`, melakukan *imputation* juga dapat dilakukan dengan beberapa paket lain dengan metode dan atau pendekatan yang berbeda. Seperti paket `Hmisc` yang juga cukup populer dikalangan pengguna R menawarkan metode *imputation* dengan beberapa algoritme.

\vspace{0.1in}

Misalnya, dalam paket `Hmisc` terdapat fungsi `impute()` di mana pengguna dapat melakukan *imputation* dengan metode yang didefinisikan sendiri (contoh: *mean, max, median,* dll). Paket `mi` juga bisa digunakan untuk melakukan *imputation* dengan menggunakan metode *Predictive Mean Matching Method*.
